<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Hub de Análise</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="./src/output.css">
    <script type="module">
        try {
            // Importa e disponibiliza o Firebase globalmente
            const { initializeApp } = await import("https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js");
            const { getAuth, signInAnonymously, onAuthStateChanged } = await import("https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js");
            const { getFirestore, collection, onSnapshot, query } = await import("https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js");

            const firebaseConfig = {
                apiKey: "AIzaSyBkzz0CflvDNXcoa30-_fSIwD62SBF29SQ",
                authDomain: "hubmonitoramento.firebaseapp.com",
                projectId: "hubmonitoramento",
                storageBucket: "hubmonitoramento.appspot.com",
                messagingSenderId: "828068813283",
                appId: "1:828068813283:web:f2a3f64efeff8a7f88e8d6",
                measurementId: "G-QF0ETTB8Y2"
            };

            window.firebase = {
                app: initializeApp(firebaseConfig),
                getAuth, signInAnonymously, onAuthStateChanged,
                getFirestore, collection, onSnapshot, query
            };

            // Sinaliza que o Firebase foi carregado
            window.firebaseLoaded = true;
            window.dispatchEvent(new Event('firebaseReady'));
            console.log('Firebase carregado com sucesso');

        } catch (error) {
            console.error('Erro ao inicializar Firebase:', error);
            // Fallback: cria um objeto Firebase mock para testar interface
            window.firebase = {
                getFirestore: () => ({}),
                collection: () => ({}),
                query: () => ({}),
                onSnapshot: (q, callback) => {
                    // Mock de dados para teste
                    setTimeout(() => callback({ docs: [] }), 1000);
                    return () => {};
                }
            };
            window.firebaseLoaded = true;
            window.dispatchEvent(new Event('firebaseReady'));
        }
    </script>
</head>
<body class="bg-gray-100">
    <script>
        // Captura erros globais para debug
        window.addEventListener('error', function(e) {
            console.error('Erro JavaScript capturado:', e.error);
            console.error('Linha:', e.lineno, 'Coluna:', e.colno);
            console.error('Arquivo:', e.filename);
        });
        
        // Previne erros relacionados a variáveis não definidas como dragEvent
        window.onerror = function(msg, url, line, col, error) {
            if (msg.includes('dragEvent')) {
                console.warn('Erro relacionado a dragEvent ignorado:', msg);
                return true; // Previne que o erro apareça no console
            }
            return false;
        };
    </script>
    <div id="root"></div>
    
    <!-- Scripts React carregados estaticamente após Firebase -->
    <script type="text/babel" src="./src/components/ClientList.jsx"></script>
    <script type="text/babel" src="./src/components/AnalysisDashboard.jsx"></script>
    <script type="text/babel" src="./src/App.jsx"></script>
    <script type="text/babel">
        // Aguarda Firebase estar pronto antes de renderizar
        function initializeApp() {
            if (window.firebase && window.firebase.getFirestore && window.App) {
                const { createRoot } = ReactDOM;
                const root = createRoot(document.getElementById('root'));
                root.render(React.createElement(window.App));
            } else {
                // Aguarda um pouco mais e tenta novamente
                setTimeout(initializeApp, 100);
            }
        }
        
        // Inicia a aplicação
        window.addEventListener('firebaseReady', initializeApp);
        setTimeout(initializeApp, 300); // Fallback
    </script>
</body>
</html>